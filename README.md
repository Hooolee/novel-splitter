# 拆书助手

<div align="center">

一个强大的网络小说拆书桌面应用，支持番茄小说、起点中文网等多个平台，集成 OpenAI/DeepSeek 等 LLM 进行智能分析。

![License](https://img.shields.io/badge/license-MIT-blue) ![Platform](https://img.shields.io/badge/platform-Windows%20|%20macOS-green) ![Built with Tauri](https://img.shields.io/badge/built%20with-Tauri-blue)

</div>

## ✨ 核心功能

- 🕷️ **多平台爬虫**：支持番茄小说、起点中文网，可轻松扩展其他平台
- 📥 **灵活下载**：单本小说下载或榜单批量抓取
- 🤖 **AI 智能分析**：集成 OpenAI/DeepSeek 等 API，生成小说分析报告
- 📚 **本地存储**：所有数据存储在本地，完全离线可用
- 🎨 **现代 UI**：Vue 3 + Tailwind CSS，支持深色/浅色主题
- ⚡ **高性能**：Rust 异步爬虫，支持并发下载
- 🔧 **灵活配置**：自定义 AI 提示词、模型选择、API 密钥管理

## 🎯 应用场景

- 📖 **小说研究者**：批量下载分析网络文学作品
- ✍️ **内容创作者**：学习同类型小说的写作风格和创意设定
- 📊 **数据分析师**：获取结构化的小说分析数据
- 🎓 **学生**：用于论文研究和文学分析

## 🚀 快速开始

### 环境要求

- **Node.js** >= 18.0
- **Rust** >= 1.70 （通过 [rustup](https://rustup.rs/) 安装）
- **npm** 或 **pnpm**

### 安装和运行

#### 1. 克隆项目

```bash
git clone https://github.com/Hooolee/novel-splitter.git
cd novel-splitter
```

#### 2. 安装依赖

```bash
# 安装前端依赖
npm install
# 或使用 pnpm
pnpm install
```

#### 3. 开发模式运行

```bash
# 启动 Tauri 开发应用（包含热重载）
npm run tauri dev
```

应用将在 localhost:1420 启动，同时启动 Rust 后端。

#### 4. 构建生产版本

```bash
npm run tauri build
```

生成的安装程序将位于 `src-tauri/target/release/bundle/`：
- **macOS**：`.dmg` 文件
- **Windows**：`.msi` 安装程序
- **Linux**：`.deb` 安装包

## 📖 使用指南

### 基础工作流

#### 1️⃣ 配置 API（可选但推荐）

点击左侧边栏底部的 **⚙️ 设置** 按钮：

**配置项**：
- **API Base URL**：API 端点地址（OpenAI 或其他兼容服务）
- **API 密钥**：填入你的 API 密钥
  - [OpenAI API Keys](https://platform.openai.com/api-keys)
  - [DeepSeek API Keys](https://platform.deepseek.com/api-keys)
- **模型选择**：选择使用的模型（点击"获取模型列表"按钮拉取可用模型）
- **自定义提示词**：修改 AI 分析的提示词（可选）
- **AI 分析读取章数**：设置 AI 分析时读取的章节数量（默认 5 章，章数越多分析越准确但消耗 Token 越多）
- **蜘蛛窗口（调试模式）**：勾选以显示浏览器窗口，用于调试起点 WAF/验证码

**设置会自动保存到浏览器本地存储，下次启动应用时自动恢复。**

#### 2️⃣ 下载小说

**模式选择**：点击左侧边栏顶部的分段控制器选择下载模式

##### 方式 A：单本小说下载

1. 选择 **单本下载** 模式
2. 在顶部配置栏选择 **平台**（番茄小说 / 起点中文网）
3. 粘贴小说 URL 到 **小说主页链接** 输入框
4. 输入要下载的 **抓取章数**（例如 100）
5. 点击 **⬇ 开始下载** 按钮
6. 查看下方日志窗口的实时进度

```
示例 URL：
- 番茄小说：https://fanqienovel.com/page/7361653460183288894
- 起点中文网：https://www.qidian.com/book/1041637443/
```

##### 方式 B：榜单批量抓取

1. 选择 **榜单监控** 模式
2. 选择 **平台**（番茄小说 / 起点中文网）
3. 粘贴 **榜单链接** 到输入框（需要从网站复制榜单页面 URL）
4. 设置 **抓取本数**（从排名前 N 的小说中抓取）
5. 设置 **每本章数**（每部小说下载多少章）
6. 点击 **🚀 扫榜** 按钮
7. 应用会自动下载符合条件的多部小说

```
示例 URL：
- 番茄小说（男频阅读榜·东方仙侠）：https://fanqienovel.com/rank/1_2_1140
- 起点中文网（月票榜）：https://www.qidian.com/rank/yuepiao/
```

**进度实时显示**：
- 下载中的小说名称
- 当前章节进度

#### 3️⃣ AI 分析

下载完成后，可以手动触发 AI 分析：

1. 在左侧文件树中，将鼠标悬停在小说名称上
2. 点击出现的 **✨ AI 分析图标按钮**
3. 应用会读取前 N 章内容（可在设置中配置，默认 5 章），调用 AI API 生成分析结果

**分析内容**：
- 📝 **题材**：网络文学分类（玄幻、言情、悬疑等）
- 🎬 **风格**：故事讲述风格特点
- ✨ **金手指**（主要卖点）：小说的核心创意设定
- 📖 **故事开头**：开篇的高度概括
- 🔥 **核心看点**：最吸引人的情节设置

**分析结果**：
- 自动保存到小说目录下的 `info.json`
- 在小说信息卡片中显示

#### 4️⃣ 查看和管理下载的小说

**文件树视图**（左侧边栏）：

```
downloads/
├── 诡秘之主
│   ├── 01.txt
│   ├── 02.txt
│   └── info.json
├── 凡人修仙传
│   ├── 01.txt
│   └── info.json
└── ...
```

**操作**：

| 操作 | 方法 | 说明 |
|------|------|------|
| 查看小说信息 | 点击小说名称（文件夹） | 显示元数据和 AI 分析结果 |
| 查看章节内容 | 点击章节文件 | 在右侧面板显示章节全文 |
| AI 分析小说 | 悬停小说名称 → 点击 ✨ 按钮 | 调用 AI 生成分析报告 |
| 删除小说 | 悬停小说名称 → 点击 🗑️ 按钮 | 永久删除整部小说及所有章节 |
| 删除章节 | 悬停章节文件 → 点击 ✕ 按钮 | 删除单个章节文件 |
| 刷新文件树 | 点击 Resources 旁的 🔄 按钮 | 重新扫描下载目录 |

### 高级功能

#### 📋 导出分析结果

在右侧 **拆书结果** 面板中，点击 **📤 导出结果** 按钮：
- 将当前分析结果导出为 `.md` 文件
- 保存到对应小说的文件夹中

#### 📝 章节分析

1. 在文件树中点击选择一个章节
2. 右侧 **原文预览** 面板显示章节内容
3. 点击 **🪄 开始拆书** 按钮
4. AI 会对当前章节进行分析，结果显示在 **拆书结果** 面板

#### 👁️ 调试爬虫问题

如果遇到爬虫失败或被 WAF 阻止：

1. 进入 **⚙️ 设置** → 勾选 **蜘蛛窗口（调试起点 WAF/验证码）**
2. 重新运行下载
3. 浏览器窗口会显示爬虫访问的网页
4. 可以手动解决验证码或观察爬虫行为
5. 查看日志文件了解详细错误信息

#### 📜 查看应用日志

点击页脚的 **查看日志** 按钮：

- 显示 `app.log` 的内容
- 包含爬虫错误、API 调用日志等
- 可点击 **清空日志** 清除历史

## 📁 文件结构

### 前端代码（Vue 3 + TypeScript）

```
src/
├── App.vue                 # 主应用组件（核心 UI）
├── main.ts                 # 应用入口
└── style.css               # 全局样式
```

**主要功能模块**：
- 📥 **下载管理**：单本/榜单模式切换、进度显示
- 🎨 **UI 组件**：设置模态框、日志查看器、文件树
- 🤖 **AI 集成**：流式响应处理、结果解析
- 📂 **文件管理**：树形视图、删除操作

### 后端代码（Rust + Tauri）

```
src-tauri/src/
├── lib.rs                  # 核心 Tauri 命令接口
├── main.rs                 # 应用启动
├── spiders/
│   ├── mod.rs              # 爬虫 trait 和路由
│   ├── fanqie.rs           # 番茄小说爬虫
│   └── qidian.rs           # 起点中文网爬虫
├── browser_spider.rs       # 无头浏览器爬虫（WAF 处理）
└── ai.rs                   # AI 集成模块
```

**核心命令**：
- `start_download`：下载单本小说
- `scan_and_download_rank`：爬取榜单并下载
- `start_ai_analysis`：触发 AI 分析（流式事件）
- `get_file_tree`：获取文件树结构
- `get_file_content`：读取文件内容
- `delete_novel` / `delete_chapter`：删除文件

## 🛠️ 开发命令

```bash
# 启动 Tauri 开发应用（前端热重载 + Rust 后端）
npm run tauri dev

# 构建前端（Vite）
npm run build

# 预览生产构建
npm run preview

# 构建最终应用包
npm run tauri build
```

## 🔌 扩展和定制

### 添加新的爬虫平台

1. 创建新文件 `src-tauri/src/spiders/newplatform.rs`
2. 实现爬虫逻辑
3. 在 `src-tauri/src/spiders/mod.rs` 中注册
4. 在前端 `src/App.vue` 更新平台选择器

### 自定义 AI 分析提示词

在设置模态框中修改 **自定义提示词** 字段：
- **拆单章**：用于分析单个章节的提示词
- **总结前几章**：用于 AI 自动分析整部小说的提示词

## 📊 数据存储

### 目录结构

```
downloads/
├── 小说1/
│   ├── 01.txt       # 第 1 章
│   ├── 02.txt       # 第 2 章
│   └── info.json    # 小说元数据和 AI 分析结果
├── 小说2/
│   └── ...
└── ...
```

### info.json 格式

```json
{
  "title": "小说标题",
  "url": "https://...",
  "tags": ["标签1", "标签2"],
  "word_count": "100万字",
  "description": "小说简介...",
  "ai_analysis": {
    "genre": "题材",
    "style": "风格",
    "goldfinger": "金手指",
    "opening": "开头",
    "highlights": "看点"
  }
}
```

## 🔐 隐私和安全

- ✅ **完全离线**：所有数据存储在本地，无云同步
- ✅ **API 密钥本地保存**：密钥存储在浏览器 localStorage，不上传到任何服务器
- ✅ **开源透明**：完整的代码可审计
- ⚠️ **合法使用**：请确保在遵守当地法律和网站条款的情况下使用爬虫功能

## 🐛 常见问题

### Q: 爬虫失败或被拒绝访问？

**A**：
1. 检查网络连接
2. 尝试启用"蜘蛛窗口（调试模式）"观察爬虫行为
3. 查看日志文件了解详细错误
4. 可能需要更换 IP 或等待一段时间后重试
5. 也可能网站内容结构调整，需要重新完成适配

### Q: AI 分析返回错误？

**A**：
1. 验证 API 密钥是否正确
2. 检查账户余额是否充足
3. 查看网络连接是否正常
4. 点击"获取模型列表"确认模型名称正确
5. 查看日志获取 API 错误信息

### Q: 如何更换下载目录？

**A**：
在顶部配置栏修改 **保存目录** 输入框的值（默认为 `../downloads`）。

### Q: 支持哪些 API 提供商？

**A**：
- ✅ OpenAI（gpt-4, gpt-3.5-turbo 等）
- ✅ DeepSeek（deepseek-chat 等）
- ✅ 其他兼容 OpenAI 的 API（可自定义 API Base URL）

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

### 开发流程

1. Fork 项目
2. 创建特性分支 (`git checkout -b feature/amazing-feature`)
3. 提交更改 (`git commit -m 'Add amazing feature'`)
4. 推送到分支 (`git push origin feature/amazing-feature`)
5. 开启 Pull Request

## 📄 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。


**⭐ 如果这个项目对你有帮助，请给个 Star！**
